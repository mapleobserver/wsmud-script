//~silent
// æŒ‚æœºè‡ªåŠ¨ç»ƒä¹ 
// å››åŒºç™½ä¸‰ä¸‰
($localVer) = 2021022201
($changeLog) = å¯è‡ªå®šä¹‰ç»ƒä¹ ç»“æŸåæ‰§è¡Œå‘½ä»¤ï¼›æ–°å¢æ‰‹åŠ¨å¡«å†™æŠ€èƒ½çš„åŠŸèƒ½ï¼ŒæŒ‰ä»ä¸Šåˆ°ä¸‹é¡ºåºç»ƒä¹ ï¼›å¯è‡ªå®šä¹‰ç»ƒä¹ æŠ€èƒ½ï¼›å¯æ‰¹é‡å…³é—­è§¦å‘å¹¶åœ¨ç»ƒä¹ ç»“æŸåé‡æ–°å¼€å¯ï¼›åŸåœ°é˜²æ‰çº¿åŠŸèƒ½ã€‚
($repourl) = https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script@latest
@js ($version) = $.ajax({type: "GET", url: "(repourl)/version.txt", async: false, cache: false}).responseText;
//@print (version)
@js ($remoteVer) = var v = (version);v.jqlx
[if] (localVer) != (remoteVer)
  @js WG.SendCmd("tm å½“å‰ç²¾ç¡®ç»ƒä¹ ç‰ˆæœ¬ã€(localVer)ã€‘ï¼Œå°†å¼€å§‹è‡ªåŠ¨æ›´æ–°è‡³æœ€æ–°ã€(remoteVer)ã€‘ã€‚")
  ($f_ss)={"name":"ç²¾ç¡®ç»ƒä¹ ","source":"(repourl)/æå‡/ç²¾ç¡®ç»ƒä¹ .flow.txt","finder":"æå‡"}
  @js var time = Date.parse( new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
  @wait 1000
  ($log) = ç²¾ç¡®ç»ƒä¹ å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆã€(remoteVer)ã€‘ï¼Œå³å°†è‡ªåŠ¨è¿è¡Œã€‚æœ¬æ¬¡æ›´æ–°å†…å®¹ï¼š(changeLog)
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>
  @js var f=(f_ss);ManagedPerformerCenter.start(f["name"], FlowStore.get(f["name"]));
  [exit]
[else]
  ($log) = å¼€å§‹è¿è¡Œç²¾ç¡®ç»ƒä¹ ï¼Œå½“å‰ç‰ˆæœ¬ã€(remoteVer)ã€‘ã€‚æ›´æ–°å†…å®¹ï¼š(changeLog)
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>

@toolbar jh
//è·å–å¢ƒç•Œ
[while] (jj) == null
  @toolbar score
  @js ($jj) = $(`span[data-prop=level]`).text()
//è·å–ç­‰çº§ä¸Šé™
[while] (level) == null
  @toolbar skills
  @js ($level) = /\d+/.exec($(".obj-money").text())['0']

//å‚æ•°é¢„ç½®
[(LXMap)==null]($LXMap) = ä½æˆ¿-ç»ƒåŠŸæˆ¿
[if] (:room å‰¯æœ¬åŒºåŸŸ) == true
  ($LXMap) = åŸåœ°ä¸åŠ¨
  ($LXEnd) = åŸåœ°é˜²æ‰çº¿
  ($LXtts) = æ‰“å¼€
[(OffLxTriggers) == null]($OffLxTriggers) = ç»­å†°å¿ƒ,ç»­é£ç¿¼,ç»­è¯é£ç¿¼,é¼“èˆç»­è¯é£ç¿¼,ç»­è¯é£ç¿¼å¾½ç« ,è¡¥å†°å¿ƒ,è¡¥é£ç¿¼
[(Chiyao) == null]($Chiyao) = å¦
[(Feiyi) == null]($Feiyi) = å¦
[(LXEnd) == null]($LXEnd) = é—­å…³æˆ–æŒ–çŸ¿
[LXAfter] == null]($LXAfter) = $zdwk
[(LXtts) == null]($LXtts) = å…³é—­
[(Type) == null]($Type) = ç»ƒè‡³ä¸Šé™

//é€‰æ‹©ç»ƒä¹ æ–¹å¼ã€å…¶å®ƒé€‰é¡¹
#input ($info) = <ord>å½“å‰æŠ€èƒ½ä¸Šé™ä¸º(level)çº§</ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
#select ($Type) = ç»ƒä¹ æ–¹å¼,æŒ‡å®šç­‰çº§|ç»ƒè‡³ä¸Šé™|æ‰‹åŠ¨å¡«å†™,(Type)
#input ($LXBefore) = ç»ƒä¹ å‰æ‰§è¡Œå‘½ä»¤(ç”¨è‹±æ–‡;éš”å¼€),(LXBefore)
#input ($OffLxTriggers)=å…³é—­è§¦å‘(å¤šä¸ªè§¦å‘åå­—ç”¨è‹±æ–‡é€—å·éš”å¼€),(OffLxTriggers)
#select ($LXMap) = ç»ƒä¹ åœ°ç‚¹,ä½æˆ¿-ç»ƒåŠŸæˆ¿|å¸®ä¼š-ç»ƒåŠŸæˆ¿|åŸåœ°ä¸åŠ¨,(LXMap)
#select ($Chiyao) = æ˜¯å¦åƒå†°å¿ƒä¸¹,æ˜¯|å¦,(Chiyao)
#select ($Feiyi) = æ˜¯å¦è¡¥é£ç¿¼(è¯·äº‹å…ˆè£…å¤‡é£ç¿¼å‰‘),æ˜¯|å¦,(Feiyi)
#select ($LXEnd) = ç»ƒä¹ ç»“æŸåæ“ä½œ,åŸåœ°é˜²æ‰çº¿|é—­å…³æˆ–æŒ–çŸ¿|æ‰“å|è‡ªå®šä¹‰å‘½ä»¤,(LXEnd)
#input ($LXAfter) = ç»ƒä¹ ç»“æŸåæ‰§è¡Œå‘½ä»¤(è‡ªå®šä¹‰å‘½ä»¤æ¨¡å¼ï¼Œå¤šä¸ªå‘½ä»¤ç”¨è‹±æ–‡;éš”å¼€ï¼Œé»˜è®¤è¯·å¡«$zdwk),(LXAfter)
#select ($LXtts) = ç»ƒä¹ ç»“æŸåè¯­éŸ³æé†’,æ‰“å¼€|å…³é—­,(LXtts)
#config

//è·å–æŠ€èƒ½åˆ—è¡¨ã€æ ¹æ®ç»ƒä¹ æ–¹å¼æ˜¾ç¤ºä¸åŒé€‰é¡¹
[if] (Type) == æŒ‡å®šç­‰çº§ || (Type) == ç»ƒè‡³ä¸Šé™
  #input ($info1) = ç»ƒä¹ æ–¹å¼ï¼š<ord>(Type)</ord>ï¼›ä¸Šé™ç­‰çº§ï¼š<ord>(level)</ord>ï¼›åƒå†°å¿ƒä¸¹ï¼š<ord>(Chiyao)</ord>ï¼›è¡¥é£ç¿¼ï¼š<ord>(Feiyi)</ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
  [if] (Type) == æŒ‡å®šç­‰çº§
    #input ($info2) = <ord>éœ€è¦ç»ƒä¹ å“ªäº›æŠ€èƒ½ï¼Œåœ¨å³è¾¹è¾“å…¥æ¡†ä¸­å¡«å…¥æŒ‡å®šç­‰çº§å³å¯ï¼Œä¸ç»ƒä¹ çš„ä¿æŒä¸å˜ã€‚</ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
  ($_i) = 0
  [while] (_i) < 62
    @js ($s(_i)) = $(".skill-item").eq('(_i)').attr('skid')
    [if] (s(_i)) == null
      [break]
    @js ($n(_i)) = $(".skill-item").eq('(_i)').html().match(/[^\d]*/)
    @js ($n(_i)) = '(n(_i))'.replace(/span class="skill-level"/,'')
    @js ($n(_i)) = '(n(_i))'.replace(/<>/, '')
    @js ($ln(_i)) = $(".skill-item").eq('(_i)').text().match(/[0-9]+/)
    [if] (s(_i)) != literate && (s(_i)) != lianyao
      [if] (Type) == æŒ‡å®šç­‰çº§
        #input ($l(_i)) = (n(_i))å½“å‰ç­‰çº§(ln(_i)),(ln(_i))
      [else]
        #select ($k(_i)) = (n(_i))å½“å‰ç­‰çº§(ln(_i)),ç»ƒä¹ |è·³è¿‡,è·³è¿‡
    ($_i) = (_i) + 1
  #config
[else if] (Type) == æ‰‹åŠ¨å¡«å†™
  #input ($info1) = ç»ƒä¹ æ–¹å¼ï¼š<ord>(Type)</ord>ï¼›ä¸Šé™ç­‰çº§ï¼š<ord>(level)</ord>ï¼›åƒå†°å¿ƒä¸¹ï¼š<ord>(Chiyao)</ord>ï¼›è¡¥é£ç¿¼ï¼š<ord>(Feiyi)</ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
  #input ($info2) = <ord>æ‰‹åŠ¨å¡«å†™æŠ€èƒ½ï¼Œä¼šæŒ‰ç…§ä»ä¸Šå¾€ä¸‹é¡ºåºç»ƒä¹ </ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
  #select ($manType) = ç»ƒä¹ æ–¹å¼,æŒ‡å®šç­‰çº§|ç»ƒè‡³ä¸Šé™,ç»ƒè‡³ä¸Šé™
  @js ($Skill)=var ss="(Skill)";ss.replace(/ï¼Œ/g,",").replace(/"/g,"").replace(/'/g,"")
  @js ($ss)=var ss=("\""+"(Skill)"+"\"");ss.replace(/,/g,"\",\"").split(",")
  ($_i) = 0
  [while] (_i) < 30
    @js ($n(_i)) = [(ss)][(_i)]
    ($n) = (_i) + 1
    #input ($n(_i)) = ç»ƒä¹ æŠ€èƒ½(n),(n(_i))
    ($_i) = (_i) + 1
  #config
  ($_i) = 0
  [while] (_i) < 30
    [if] (n(_i)) != null && (n(_i)) != ç‚¼è¯æœ¯ && (n(_i)) != è¯»ä¹¦å†™å­—
      @js ($skillbase) = '(n(_i))'.indexOf('åŸºæœ¬')
      [if] (skillbase) != -1 || (n(_i)) == é‡å…½æ‰‘å’¬
        ($skilltype) = base
      [else]
        ($skilltype) = skill
      @js ($s(_i)) = $(".(skilltype):contains((n(_i)))").attr("skid")
      [if] (s(_i)) != null
        //@print (s(_i))
        @js ($ln(_i)) = $(".(skilltype):contains((n(_i)))").text().match(/[0-9]+/)
        @js ($n(_i)) = $(".(skilltype):contains((n(_i)))").html().match(/[^\d]*/)
        @js ($n(_i)) = '(n(_i))'.replace(/span class="skill-level"/,'').replace(/<>/, '').replace(/âœ”/, '').replace(/<span.*>.*<\/span>/g,'')
        [if] (lx_skill) == null
          ($lx_skill) = '(s(_i))'
        [else]
          ($lx_skill) = (lx_skill),'(s(_i))'
        [if] (lx_name) == null
          ($lx_name) = '(n(_i))'
        [else]
         ($lx_name) = (lx_name),'(n(_i))'
        [if] (lx_level) == null
          ($lx_level) = (ln(_i))
        [else]
          ($lx_level) = (lx_level),(ln(_i))
    ($_i) = (_i) + 1
  // æ‰‹åŠ¨å¡«å†™æ¨¡å¼çš„ä¸¤ç§ç»ƒä¹ æ–¹å¼
  @js ($slen) = [(lx_skill)].length
  [if] (manType) == æŒ‡å®šç­‰çº§
    #input ($info2) = ç»ƒä¹ æ–¹å¼ï¼š<ord>(Type)-(manType)</ord>ï¼›ä¸Šé™ç­‰çº§ï¼š<ord>(level)</ord>ï¼›åƒå†°å¿ƒä¸¹ï¼š<ord>(Chiyao)</ord>ï¼›è¡¥é£ç¿¼ï¼š<ord>(Feiyi)</ord>,ğŸ‘‡ğŸ‘‡ğŸ‘‡
    [if] (slen) == 0
      @print <ord>æœªè®¾å®šä»»ä½•æŠ€èƒ½ï¼</ord>
      $zdwk
      [exit]
    ($_i) = 0
    [while] (_i) < (slen)
      @js ($n(_i)) = [(lx_name)][(_i)]
      @js ($s(_i)) = [(lx_skill)][(_i)]
      @js ($ln(_i)) = [(lx_level)][(_i)]
      #input ($l(_i)) = (n(_i))å½“å‰ç­‰çº§(ln(_i)),(ln(_i))
      ($_i) = (_i) + 1
    #config

@cmdDelay 500
//ç”Ÿæˆç»ƒä¹ æ¸…å•
($lx_skill) = null
($lx_name) = null
($lx_level) = null
($_j) = 0
[while] (_j) < (_i)
  [if] (k(_j)) == ç»ƒä¹  || (manType) == ç»ƒè‡³ä¸Šé™
    @js ($l(_j)) = (level)
  [if] (l(_j)) != null && (l(_j)) > (ln(_j)) && (s(_j)) != null
    //æŠ€èƒ½id
    [if] (s(_j))==force || (s(_j))==unarmed || (s(_j))==dodge || (s(_j))==parry || (s(_j))==sword || (s(_j))==blade || (s(_j))==whip || (s(_j))==throwing || (s(_j))==staff || (s(_j))==club || (s(_j))==bite
      ($baseYes) = true
    [if] (lx_skill) == null
      ($lx_skill) = '(s(_j))'
    [else]
      [if] (baseYes) == true && (Type) != æ‰‹åŠ¨å¡«å†™
        ($lx_skill) = '(s(_j))',(lx_skill)
      [else]
        ($lx_skill) = (lx_skill),'(s(_j))'
    //ç»ƒä¹ ç­‰çº§
    [if] (lx_level) == null
      ($lx_level) = (l(_j))
    [else]
      [if] (baseYes) == true && (Type) != æ‰‹åŠ¨å¡«å†™
        ($lx_level) = '(l(_j))',(lx_level)
      [else]
        ($lx_level) = (lx_level),'(l(_j))'
    //æŠ€èƒ½åç§°
    @js ($n(_j)) = '(n(_j))'.replace(/âœ”/, '')
    @js ($n(_j)) = '(n(_j))'.replace(/<span.*>.*<\/span>/g,'')
    @print ç»ƒä¹ (n(_j))[(s(_j))]è‡³<wht>(l(_j))</wht>çº§
    @js ($n(_j)) = '(n(_j))'.replace(/<[^>]+>/g,'')
    tm ç»ƒä¹ (n(_j))[(s(_j))]è‡³(l(_j))çº§
    [if] (lx_name) == null
      ($lx_name) = '(n(_j))'
    [else]
      [if] (baseYes) == true && (Type) != æ‰‹åŠ¨å¡«å†™
        ($lx_name) = '(n(_j))',(lx_name)
      [else]
        ($lx_name) = (lx_name),'(n(_j))'
  ($_j) = (_j) + 1
//@print æŠ€èƒ½åç§°ï¼š(lx_name)
//@print æŠ€èƒ½ä»£ç ï¼š(lx_skill)
//@print ç»ƒä¹ ç­‰çº§ï¼š(lx_level)
[if] (lx_skill) == null
  <ord>æœªè®¾å®šä»»ä½•æŠ€èƒ½ï¼</ord>
  $zdwk
  [exit]
[if] (Type) == æ‰‹åŠ¨å¡«å†™
  ($Skill) = (lx_name)
  //@print (Skill)

//å…³é—­æŒ‡å®šè§¦å‘ã€æ£€æŸ¥è§¦å‘æœ‰æ•ˆæ€§
[if] (OffLxTriggers) != null
  @js ($tgs)=var ts=("\""+"(OffLxTriggers)"+"\"").replace(/ï¼Œ/g,",");ts.replace(/,/g,"\",\"").split(",")
  @js ($tl)=[(tgs)].length
  @print å…³é—­æŒ‡å®šè§¦å‘ï¼š(OffLxTriggers)
  ($num)=0
  [while] (num)<(tl)
    @js ($t)=[(tgs)][(num)]
    @js ($checkT) = unsafeWindow.TriggerCenter._checkName("(t)")
    [if] (checkT) != true
      [if] (lxtrigger) == null
        ($lxtrigger) = (t)
      [else]
        ($lxtrigger) = (lxtrigger),(t)
      @js ($checkT2) = unsafeWindow.TriggerCenter._triggers["(t)"].active()
      [if] (checkT2) == true
        [if] (offT) == null
          ($offT) = (t)
        [else]
          ($offT) = (offT),(t)
      @js ToRaid.perform(`@off (t)`);
    ($num)=(num)+1
  ($OffLxTriggers) = (lxtrigger)
  //@print (OffLxTriggers)
  //@print (offT)

<-stopSSAuto
//è·å–æŠ€èƒ½æ•°é‡
@js ($skill_num) = [(lx_skill)].length
//ä¼ é€åˆ°ç»ƒåŠŸæˆ¿
stopstate
[if] (LXMap) != åŸåœ°ä¸åŠ¨
  $to (LXMap)
//ç»ƒä¹ å‰æ‰§è¡Œå‘½ä»¤
[if] (LXBefore) != null
  (LXBefore)
  @wait 5000
//å¾ªç¯ç»ƒä¹ 
($num)=0
($tip_done)=start
[while] (num) < (skill_num)
  //å¼€åœºåƒè¯å¼€é£ç¿¼
  [if] (num) == 0
    [if] (:status food) == false && (Chiyao) == æ˜¯ && {bå†°å¿ƒä¸¹}? != null
      stopstate
      use {bå†°å¿ƒä¸¹}?
      @await 1000
    //åˆ¤æ–­æ˜¯å¦ç”¨é£ç¿¼
    [if] (:status fy) == false && (Feiyi) == æ˜¯
      stopstate
      use (:eq0)
      @await 1000
  //å‡ ç§ç»ƒä¹ èŠ‚ç‚¹åˆ¤æ–­
  [if] (tip_done) != null || (tip_limit) != null || (tip_base) != null
    ($tip_done) = null
    ($tip_limit) = null
    ($tip_base) = null
    //è·å–æŠ€èƒ½idå’Œç»ƒä¹ ç­‰çº§
    @js ($skill_name) = [(lx_name)][(num)]
    @js ($skill_id) = [(lx_skill)][(num)]
    @js ($target_level) = [(lx_level)][(num)]
    stopstate
  //å¼€å§‹ç»ƒä¹ 
  @await 500
  //æ£€æŸ¥å½“å‰æˆ¿é—´å’ŒçŠ¶æ€
  [if] (:room) != (LXMap) && (LXMap) != åŸåœ°ä¸åŠ¨
    stopstate
  [if] (:room) == æ‰¬å·åŸ-çŸ¿å±± || (:state) == æŒ–çŸ¿
    stopstate
    (LXBefore)
    @await 5000
    $to (LXMap)
    @await 500
  //å¼€å§‹ç»ƒä¹ ï¼ŒåŒæ—¶é¿å…@tipå¯¹åŒä¸€å¥å†…å®¹é‡å¤ç”Ÿæ•ˆ
  lianxi (skill_id) (target_level)
  //åˆ¤æ–­ç»ƒä¹ çŠ¶æ€
  @tip ç¼ºä¹($tip_limit)ç»éªŒ|å·²ç»ç»ƒä¹ ($tip_done)äº†|ç»ƒä¹ ($tip_done)æ¯•|ä½ çš„($tip_base)åŠŸç«å€™æœªåˆ°|ç­‰çº§($levelup)äº†|æå‡åˆ°($levelup)çº§|ä½ çš„($tip_qn)ä¸å¤Ÿ
  [if] (levelup) != null
    //åˆ¤æ–­æ˜¯å¦åƒè¯
    [if] (:status food) == false && (Chiyao) == æ˜¯ && {bå†°å¿ƒä¸¹}? != null
      stopstate
      use {bå†°å¿ƒä¸¹}?
      @await 1000
    //åˆ¤æ–­æ˜¯å¦ç”¨é£ç¿¼
    [if] (:status fy) == false && (Feiyi) == æ˜¯
      stopstate
      use (:eq0)
      @await 1000
    ($levelup) = null
    [continue]
  [if] (tip_limit) != null
    tm æŠ€èƒ½ä¸Šé™ä¸è¶³(target_level)çº§ï¼Œ(skill_name)æ— æ³•ç»§ç»­ç»ƒä¹ ã€‚
  [else if] (tip_base) != null
    tm åŸºç¡€æŠ€èƒ½ç­‰çº§ä¸è¶³(target_level)çº§ï¼Œ(skill_name)æ— æ³•ç»§ç»­ç»ƒä¹ ã€‚
  [else if] (tip_done) != null
    tm (skill_name)å·²ç»ƒä¹ (target_level)çº§ï¼Œç»§ç»­ç»ƒä¹ ä¸‹ä¸€ä¸ªã€‚
  [else if] (tip_qn) != null
    tm æ½œèƒ½ä¸å¤Ÿï¼Œåœæ­¢ç»ƒä¹ ï¼
    [break]
  ($num) = (num) + 1
stopstate
//è¿˜åŸæŒ‡å®šè§¦å‘
[if] (offT) != null
  @js ($tgs)=var ts=("\""+"(offT)"+"\"").replace(/ï¼Œ/g,",");ts.replace(/,/g,"\",\"").split(",")
  @js ($tl)=[(tgs)].length
  @print è¿˜åŸæŒ‡å®šè§¦å‘
  ($num)=0
  [while] (num)<(tl)
    @js ($t)=[(tgs)][(num)]
    @js ToRaid.perform(`@on (t)`);
    ($num)=(num)+1
//ç»ƒä¹ ç»“æŸ
[if] (LXEnd) == åŸåœ°é˜²æ‰çº¿
  [if] (LXtts) == æ‰“å¼€
    $tts ç»ƒä¹ ç»“æŸï¼Œè¯·æ‰‹åŠ¨è¿›è¡Œåç»­æ“ä½œ;$wait 5000;$music
  [while] true
    tm (:hour):(:minute):(:second) åŸåœ°é˜²æ‰çº¿åŠŸèƒ½å·²å¼€å¯
    lianxi (skill_id) (target_level)
    @await 10000
[else if] (LXEnd) == é—­å…³æˆ–æŒ–çŸ¿
  $zdwk
[else if] (LXEnd) == æ‰“å
  dazuo
[else if] (LXEnd) == è‡ªå®šä¹‰å‘½ä»¤
  (LXAfter)
stopSSAuto->