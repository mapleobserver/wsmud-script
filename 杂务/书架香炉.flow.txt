//~silent
($localVer) = 20211124001
($changeLog) = ğŸŒŸ çš‡åŸæœç´¢ä¹¦æ¶é¦™ç‚‰ï¼Œå¯ä½¿ç”¨é•¿ç”Ÿæ¢å¤å†…åŠ›ã€æ…ˆèˆªåŠ é€Ÿæœç´¢ã€‚
($flowName) = ä¹¦æ¶é¦™ç‚‰
($flowCode) = sjxl
($flowPath) = æ‚åŠ¡
($flowFinder) = æ ¹æ–‡ä»¶å¤¹
($repourl) = https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script
@js ($version) = $.ajax({type: "GET", url: "(repourl)/version.txt", async: false, cache: false}).responseText;
[if] (version) != null
  @js ($remoteVer) = var v = (version);v.(flowCode)
[if] (localVer) < (remoteVer) && (remoteVer) != null
  [if] (UPnum) == null
    ($UPnum) = 0
  [if] (UPnum) < 2
    [if] (UPnum) == 1
      @print æœªè·å–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤‡ç”¨åœ°å€å†æ¬¡å°è¯•...
      ($repourl) = http://wsmud-cdn.if404.com
    ($UPnum) = (UPnum) + 1
    [if] (flowPath) != æ ¹æ–‡ä»¶å¤¹ && (flowPath) != null
      ($flowSource) = (repourl)/(flowPath)/(flowName).flow.txt
    [else]
      ($flowSource) = (repourl)/(flowName).flow.txt
    [if] (flowFinder) == null
      ($flowFinder) = æ ¹æ–‡ä»¶å¤¹
    @js WG.SendCmd("tm å½“å‰(flowName)ç‰ˆæœ¬ã€(localVer)ã€‘ï¼Œå°†å¼€å§‹è‡ªåŠ¨æ›´æ–°è‡³æœ€æ–°ã€(remoteVer)ã€‘ã€‚")
    ($f_ss)={"name":"(flowName)","source":"(flowSource)","finder":"(flowFinder)"}
    @js var time = Date.parse( new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
    @wait 1500
    ($log) = âœ…(flowName)å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆã€(remoteVer)ã€‘ï¼Œå³å°†è‡ªåŠ¨è¿è¡Œã€‚
  [else]
    ($log) = â­•(flowName)æš‚æ—¶æ— æ³•æ­£å¸¸æ›´æ–°è‡³ã€(remoteVer)ã€‘ï¼Œç›´æ¥è¿è¡Œå½“å‰ç‰ˆæœ¬ã€(localVer)ã€‘ã€‚
    ($UPnum) = null
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>
  [if] (UPnum) != null
    @js var f=(f_ss);ManagedPerformerCenter.start(f["name"], FlowStore.get(f["name"]));
    [exit]
[else]
  ($UPnum) = null
  [if] (remoteVer) == null
    ($log) = âš ï¸è·å–è¿œç¨‹ç‰ˆæœ¬å¤±è´¥ï¼Œç»´æŒå½“å‰ç‰ˆæœ¬ä¸å˜ã€‚
  [else]
    ($log) = ğŸš€å¼€å§‹è¿è¡Œ(flowName)ï¼Œå½“å‰ç‰ˆæœ¬ã€(remoteVer)ã€‘ã€‚æ›´æ–°å†…å®¹ï¼š(changeLog)
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>

//æ£€æµ‹çŠ¶æ€
@js ($fbroom) = '(:room)'.indexOf('å‰¯æœ¬åŒºåŸŸ')
[if] (fbroom) != -1 || (:state)==æ¨æ¼” || (:state)==é¢†æ‚Ÿ
  ($alert_start) = æ­£åœ¨(:state)ï¼Œåœæ­¢æµç¨‹ï¼
  [(fbroom) != -1]($alert_start) = æ­£åœ¨å‰¯æœ¬ä¸­ï¼Œåœæ­¢æµç¨‹ï¼
  @js WG.SendCmd("tm (alert_start)")
  @print <ord>(alert_start)</ord>
  [exit]

[if] (HCplan) == null
  ($HCplan) = ä¹¦æ¶å’Œé¦™ç‚‰
[if] (HCcycle) == null
  ($HCcycle) = æ˜¯
[if] (HCchangsheng) == null
  ($HCchangsheng) = æ˜¯
[if] (HCcihang) == null
  ($HCcihang) = ä¸ä½¿ç”¨
[if] (HCposui) == null
  ($HCposui) = 1
@cmdDelay 350
#select ($HCplan) = è¯·ç¡®ä¿è‡ªå·±èƒ½è‡ªç”±è¿›å‡ºä¹¦æˆ¿<br/>&nbsp*&nbspæœç´¢æ–¹æ¡ˆ,ä¹¦æ¶å’Œé¦™ç‚‰|åªä¹¦æ¶|åªé¦™ç‚‰,(HCplan)
#select ($HCcycle) = é‡å¤å°è¯•ç›´åˆ°æœåˆ°,æ˜¯|å¦,(HCcycle)
#select ($HCchangsheng) = æ˜¯å¦ç”¨é•¿ç”Ÿè¯€å›è“,æ˜¯|å¦,(HCchangsheng)
#select ($HCcihang) = ä½¿ç”¨å‰‘å¿ƒåŠ é€Ÿæœç´¢,ä¸ä½¿ç”¨|æ…ˆèˆªå‰‘å…¸|è‡ªåˆ›å†…åŠŸ,(HCcihang)
#input ($HCposui) = éœ€è¦å°†çš‡åŸ-å¹¿åœºè®¾ç½®ä¸ºä¼ é€ç‚¹<br/>&nbsp*&nbspçš‡åŸ-å¹¿åœºåœ¨ç ´ç¢è™šç©ºçš„ä½ç½®,(HCposui)
#config

[if] (HCchangsheng) == æ˜¯
  ($cs) = true
[else if] (HCchangsheng) == å¦
  ($cs) = false
[if] (HCcihang) == æ…ˆèˆªå‰‘å…¸
  ($force) = cihangjiandian
[else if] (HCcihang) == è‡ªåˆ›å†…åŠŸ
  ($force) = (:id)
[if] (HCplan) == ä¹¦æ¶å’Œé¦™ç‚‰
  ($sj) = true
  ($xl) = true
[if] (HCplan) == åªä¹¦æ¶
  ($sj) = true
  ($xl) = false
[if] (HCplan) == åªé¦™ç‚‰
  ($sj) = false
  ($xl) = true

($force0) = (:kf_nei)

<---
[if] (:mpPer) <= 0.2
  [if] (cs)
    ($force1) = (:kf_nei)
    enable force changshengjue
    @cd force.zhen
    @perform force.zhen
    @until (:cd force.zhen)==true
    enable force (force1)
  [else]
    @renew
    [continue]
--->
stopstate
[if] (force) != null
  enable force (force)
[while] (sj) || (xl)
  [if] (force) != null && (:status force)==false
    @cd force.xin
    @perform force.xin
    @tip è¿™é‡Œ($cant)æˆ˜æ–—|ä½ æ™‹å…¥($jianxin)çš„æ— ä¸Šé“å¢ƒ
    [if] (cant) != null
      ($cant) = null
      jh fam 0 start
      @await 1000
      @perform force.xin
  jh fam 0 start;psxk (HCposui)
  [if] (sj) && (xl)
    go west;go north;lu ding;
    @tip è¿™é‡Œæ²¡å•¥å¯ä»¥çœ‹çš„äº†|é™¤äº†æœ¨é›•å°±æ˜¯å¤§å‹çš„é“œé¼|æ‰¾åˆ°($zdxl)ä¸€|æ·±å¸ä¸€å£($zdxl)å†’å‡ºçš„ç¼•ç¼•é’çƒŸ
    @await 500
    go east;go east;lu sj;
    @tip è¿™é‡Œæ²¡å•¥å¯ä»¥çœ‹çš„äº†|ä¼¼ä¹è¢«äººæ·è¶³å…ˆç™»|æ‰¾åˆ°($zdsj)ä¸€æ’|æ²¡æ‰¾åˆ°ä»€ä¹ˆ($zdsj)é¡ºèµ°çš„ä¸œè¥¿
  [if] (xl) && !(sj)
    go west;go north;lu ding;
    @tip è¿™é‡Œæ²¡å•¥å¯ä»¥çœ‹çš„äº†|é™¤äº†æœ¨é›•å°±æ˜¯å¤§å‹çš„é“œé¼|æ‰¾åˆ°($zdxl)ä¸€|æ·±å¸ä¸€å£($zdxl)å†’å‡ºçš„ç¼•ç¼•é’çƒŸ
  [if] (sj) && !(xl)
    go north;go east;lu sj;
    @tip è¿™é‡Œæ²¡å•¥å¯ä»¥çœ‹çš„äº†|ä¼¼ä¹è¢«äººæ·è¶³å…ˆç™»|æ‰¾åˆ°($zdsj)ä¸€æ’|æ²¡æ‰¾åˆ°ä»€ä¹ˆ($zdsj)é¡ºèµ°çš„ä¸œè¥¿
  [if] (zdsj) != null
    [if] "{bä¹¦æ¶g}?" != "null"
      use {bä¹¦æ¶}?
      @tip ä¹¦æ¶å·²ç»æ‘†æ”¾åœ¨ä½ çš„å§å®¤ï¼Œç›®å‰å¯ä»¥å­˜æ”¾($sjNum)æœ¬ä¹¦ç±|ä½ å®¶é‡Œçš„($sjFull)å·²ç»å¤Ÿå¤§äº†
      [if] (sjNum) == 200 || (sjFull) != null
        ($HCplan) = åªé¦™ç‚‰
        @print <hiy>ä¹¦æ¶å·²åˆ°è¾¾æœ€å¤§ä¸Šé™ï¼Œæœç´¢æ–¹æ¡ˆæ”¹ä¸ºåªæœé¦™ç‚‰ã€‚</hiy>
    ($sj) = false
  [if] (zdxl) != null
    ($xl) = false
  @await 500
  [if] (:status force)==true
    [if] (sj) || (xl)
      [continue]
  @await 500
  $zdwk
  @wait 5000
  [if] (cs) = true
    [if] (HCcihang)!= ä¸ä½¿ç”¨ ||(:mpPer) <= 0.5
        @cd force.zhen
        ($force1) = (:kf_nei)
        stopstate;enable force changshengjue
        @perform force.zhen
        @until (:cd force.zhen)==true
        enable force (force1)
        $zdwk
  [if] !(sj) && !(xl)
    stopstate;enable force (force0)
    $zdwk
    [exit]
  [if] (HCcycle) == å¦
    stopstate;enable force (force0)
    $zdwk
    [exit]
  [if] (force) != null
    @cd force.xin
  [else]
    @print ç­‰å¾…20ç§’ç»§ç»­å°è¯•ã€‚
    @await 20000
  stopstate