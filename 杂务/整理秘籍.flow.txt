//~silent
// å››åŒºç™½ä¸‰ä¸‰
// è‡ªåŠ¨åˆæˆç§˜ç±æ®‹é¡µå­˜å…¥ä¹¦æ¶ï¼Œä¼˜å…ˆå­˜é—¨æ´¾è¿›é˜¶å’Œé«˜å“è´¨ç§˜ç±ã€‚
// ç‰ˆæœ¬æ£€æŸ¥
($localVer) = 2021102901
($changeLog) = è‡ªåŠ¨åˆæˆç§˜ç±æ®‹é¡µå­˜å…¥ä¹¦æ¶ï¼Œä¼˜å…ˆå­˜é—¨æ´¾è¿›é˜¶å’Œé«˜å“è´¨ç§˜ç±ã€‚
($flowName) = æ•´ç†ç§˜ç±
($flowCode) = zlmj
($flowPath) = æ‚åŠ¡
($flowFinder) = æ‚åŠ¡
($repourl) = https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script
@js ($version) = $.ajax({type: "GET", url: "(repourl)/version.txt", async: false, cache: false}).responseText;
[if] (version) != null
  @js ($remoteVer) = var v = (version);v.(flowCode)
[if] (localVer) < (remoteVer) && (remoteVer) != null
  [if] (UPnum) == null
    ($UPnum) = 0
  [if] (UPnum) < 2
    [if] (UPnum) == 1
      @print æœªè·å–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤‡ç”¨åœ°å€å†æ¬¡å°è¯•...
      ($repourl) = http://wsmud-cdn.if404.com
    ($UPnum) = (UPnum) + 1
    [if] (flowPath) != æ ¹æ–‡ä»¶å¤¹ && (flowPath) != null
      ($flowSource) = (repourl)/(flowPath)/(flowName).flow.txt
    [else]
      ($flowSource) = (repourl)/(flowName).flow.txt
    [if] (flowFinder) == null
      ($flowFinder) = æ ¹æ–‡ä»¶å¤¹
    @js WG.SendCmd("tm å½“å‰(flowName)ç‰ˆæœ¬ã€(localVer)ã€‘ï¼Œå°†å¼€å§‹è‡ªåŠ¨æ›´æ–°è‡³æœ€æ–°ã€(remoteVer)ã€‘ã€‚")
    ($f_ss)={"name":"(flowName)","source":"(flowSource)","finder":"(flowFinder)"}
    @js var time = Date.parse( new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
    @wait 1500
    ($log) = âœ…(flowName)å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆã€(remoteVer)ã€‘ï¼Œå³å°†è‡ªåŠ¨è¿è¡Œã€‚
  [else]
    ($log) = â­•(flowName)æš‚æ—¶æ— æ³•æ­£å¸¸æ›´æ–°è‡³ã€(remoteVer)ã€‘ï¼Œç›´æ¥è¿è¡Œå½“å‰ç‰ˆæœ¬ã€(localVer)ã€‘ã€‚
    ($UPnum) = null
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>
  [if] (UPnum) != null
    @js var f=(f_ss);ManagedPerformerCenter.start(f["name"], FlowStore.get(f["name"]));
    [exit]
[else]
  ($UPnum) = null
  [if] (remoteVer) == null
    ($log) = âš ï¸è·å–è¿œç¨‹ç‰ˆæœ¬å¤±è´¥ï¼Œç»´æŒå½“å‰ç‰ˆæœ¬ä¸å˜ã€‚
  [else]
    ($log) = ğŸš€å¼€å§‹è¿è¡Œ(flowName)ï¼Œå½“å‰ç‰ˆæœ¬ã€(remoteVer)ã€‘ã€‚æ›´æ–°å†…å®¹ï¼š(changeLog)
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>

// å‚æ•°é¢„å¤„ç†
[if] (TidyBook) == null
  ($TidyBook) = "tidyW":"å¦","tidyG":"æ˜¯","tidyB":"æ˜¯","tidyY":"æ˜¯","tidyP":"æ˜¯","tidyO":"æ˜¯","tidyR":"æ˜¯","tidyM":"æ˜¯"
@js ($tidyW) = var b={(TidyBook)};b.tidyW
@js ($tidyG) = var b={(TidyBook)};b.tidyG
@js ($tidyB) = var b={(TidyBook)};b.tidyB
@js ($tidyY) = var b={(TidyBook)};b.tidyY
@js ($tidyP) = var b={(TidyBook)};b.tidyP
@js ($tidyO) = var b={(TidyBook)};b.tidyO
@js ($tidyR) = var b={(TidyBook)};b.tidyR
@js ($tidyM) = var b={(TidyBook)};b.tidyM

// è®¾ç½®èœå•
#select ($tidyW) = æ˜¯å¦å­˜å…¥<wht>ç™½è‰²åŸºç¡€ç§˜ç±</wht>,æ˜¯|å¦,(tidyW)
#select ($tidyG) = æ˜¯å¦å­˜å…¥<hig>ç»¿è‰²ç§˜ç±</hig>,æ˜¯|å¦,(tidyG)
#select ($tidyB) = æ˜¯å¦å­˜å…¥<hic>è“è‰²ç§˜ç±</hic>,æ˜¯|å¦,(tidyB)
#select ($tidyY) = æ˜¯å¦å­˜å…¥<hiy>é»„è‰²ç§˜ç±</hiy>,æ˜¯|å¦,(tidyY)
#select ($tidyP) = æ˜¯å¦å­˜å…¥<hiz>ç´«è‰²ç§˜ç±</hiz>,æ˜¯|å¦,(tidyP)
#select ($tidyO) = æ˜¯å¦å­˜å…¥<hio>æ©™è‰²ç§˜ç±</hio>,æ˜¯|å¦,(tidyO)
#select ($tidyR) = æ˜¯å¦å­˜å…¥<ord>çº¢è‰²ç§˜ç±</ord>,æ˜¯|å¦,(tidyR)
#select ($tidyM) = æ˜¯å¦å­˜å…¥<hiz>é—¨æ´¾è¿›é˜¶ç§˜ç±</hiz>,æ˜¯|å¦,(tidyM)
#config

($TidyBook) = "tidyW":"(tidyW)","tidyG":"(tidyG)","tidyB":"(tidyB)","tidyY":"(tidyY)","tidyP":"(tidyP)","tidyO":"(tidyO)","tidyR":"(tidyR)","tidyM":"(tidyM)"

// ç§˜ç±æ•°æ®
//($bookW) = 'åŸºæœ¬å†…åŠŸç§˜ç±','åŸºæœ¬æ‹³è„šç§˜ç±','åŸºæœ¬è½»åŠŸç§˜ç±','åŸºæœ¬æ‹›æ¶ç§˜ç±','åŸºæœ¬å‰‘æ³•ç§˜ç±','åŸºæœ¬åˆ€æ³•ç§˜ç±','åŸºæœ¬æ–æ³•ç§˜ç±','åŸºæœ¬æ£æ³•ç§˜ç±','åŸºæœ¬é­æ³•ç§˜ç±','åŸºæœ¬æš—å™¨ç§˜ç±','é‡å…½æ‰‘å’¬ç§˜ç±'
($bookG) = 'å¤ªç¥–é•¿æ‹³','å”è¯—å‰‘æ³•','äº”è™æ–­é—¨åˆ€','äº‘é¾™é­æ³•','æ„å½¢æ­¥æ³•','ç¥é¾™å‰‘','åå±±å‰‘æ³•','æ··å…ƒä¸€æ°”','é£æªèµ°å£','ä¼è™æ‹³','ç»é—¨æ£','çŒ´æ‹³','äº‘é¾™èº«æ³•','äº‘é¾™å¿ƒæ³•','ç§‹é£æ‹‚å°˜','å¯†å®—å¿ƒæ³•','å¯†å®—å¤§æ‰‹å°','å†·æœˆç¥åŠŸ','é‡‘é›åŠŸ'
($bookB) = 'ç¥é¾™å¿ƒæ³•','äº‘é¾™å‰‘','ç¥å½¢ç™¾å˜','è›‡å²›å¥‡åŠŸ','åŒ–éª¨ç»µæŒ','èƒ¡å®¶åˆ€æ³•','å››è±¡æ­¥æ³•','é‡‘è›‡é”¥æ³•','å…«å¦æ‹³','å…«å¦æ£','äº”æ¯’ç¥åŠŸ','æ’å±±èº«æ³•','è¸æ­Œè¡Œ','ç©¿äº‘çºµ','æµäº‘æŒ','æ³°å±±æ‹³æ³•','ç¢§æ³¢ç¥åŠŸ','èŸ¾èœæ­¥æ³•','æ‘˜æ˜ŸåŠŸ','é£æ˜Ÿæœ¯','é’è èº«æ³•','ç»æƒ…æŒ','ç¥å‰‘è¯€','é¹°çˆªåŠŸ','åœ£ç«ä»¤æ³•','å¤©å—æ­¥','èº«ç©ºè¡Œ','è’™å¤å¿ƒæ³•','æ— å¸¸æ–'
($bookY) = 'é‡‘è›‡å‰‘æ³•','é‡‘è›‡æ¸¸èº«æŒ','é‡‘è›‡æ¸¸èº«æ­¥','äº”æ¯’çƒŸèæ­¥','äº”æ¯’é’©æ³•','åƒè››ä¸‡æ¯’æ‰‹','ç™½äº‘å¿ƒæ³•','æ’å±±å‰‘æ³•','å¤©é•¿æŒæ³•','ç‹‚é£å¿«åˆ€','æ‘§å¿ƒæŒ','æ¾é£å‰‘æ³•','é•‡å²³è¯€','è¡¡å±±äº”ç¥å‰‘','æ³°å±±å‰‘æ³•','ç£çŸ³ç¥åŠŸ','å¤§åµ©é˜³ç¥æŒ','åµ©å±±å‰‘æ³•','æš—å½±æµ®é¦™','è½è‹±ç¥å‰‘','ä¸‰é˜´èœˆèš£çˆª','ä¸ƒä¼¤æ‹³','ç§»é£å‰‘æ³•','å¤©ç¾½å¥‡å‰‘','åœ£ç«ç¥åŠŸ','æ®µå®¶å‰‘','ç‰å¥³å¿ƒç»','é“¶ç´¢é‡‘é“ƒ','å…¨çœŸå‰‘æ³•','ä¸­å¹³æªæ³•','è’™å¤éª‘æª'
($bookP) = 'å¯’å†°çœŸæ°”','å¼¹æŒ‡ç¥é€š','ç©ºæ˜æ‹³','çµè›‡æ–æ³•','è›¤èŸ†åŠŸ','åŒ–åŠŸå¤§æ³•','ç§»èŠ±æ¥æœ¨','æ˜ç‰åŠŸ','å‚åˆæŒ‡','æ¯æœ¨ç¥åŠŸ','ç¥ç…§ç»','è¡€æµ·é­”åŠŸ','ä¸€é˜³æŒ‡','ç„è™šæ­¥','ä¼é­”æ£','å½¼å²¸å‰‘æ³•','åœ†æœˆå¼¯åˆ€','å…ˆå¤©åŠŸ'
($bookO) = 'æ–—è½¬æ˜Ÿç§»','è¾Ÿé‚ªå‰‘æ³•','è‘µèŠ±ç¥åŠŸ','ä¸è€é•¿æ˜¥åŠŸ','ä¹é˜³ç¥åŠŸ','ä¹¾å¤å¤§æŒªç§»','å…­è„‰ç¥å‰‘','è¡€åˆ€','é»¯ç„¶é”€é­‚æŒ','ç„é“å‰‘æ³•','ä¹é˜´ç¥åŠŸ','å¤ªç„åŠŸ','æ— å¿µç¦…åŠŸ','ä¼é­”æ–','å¦‚æ¥ç¥æŒ','çœŸè¨€æ‰‹å°','çµçŠ€æ­¥','å¤©åœ°äº¤å¾é˜´é˜³å¤§æ‚²èµ‹','é¾™è±¡èˆ¬è‹¥åŠŸ'
($bookR) = 'é•¿ç”Ÿè¯€ç§˜ç±','æ…ˆèˆªå‰‘å…¸ç§˜ç±','é˜´é˜³ä¹è½¬ç§˜ç±','æˆ˜ç¥å›¾å½•ç§˜ç±','è¦†é›¨å‰‘æ³•ç§˜ç±','å¤©é­”ç­–ç§˜ç±'
($bookM) = 'å¤ªææ‹³è¿›é˜¶ç§˜ç±','æ¢¯äº‘çºµè¿›é˜¶ç§˜ç±','å…ˆå¤©å¤ªæè¿›é˜¶ç§˜ç±','å¤ªæå‰‘æ³•è¿›é˜¶ç§˜ç±','æ··å…ƒå¤©ç½¡è¿›é˜¶ç§˜ç±','é€é¥æ¸¸è¿›é˜¶ç§˜ç±','æ‰“ç‹—æ£’è¿›é˜¶ç§˜ç±','é™é¾™åå…«æŒè¿›é˜¶ç§˜ç±','åŠˆçŸ³ç ´ç‰æ‹³è¿›é˜¶ç§˜ç±','ç´«éœç¥åŠŸè¿›é˜¶ç§˜ç±','ç‹‚é£å¿«å‰‘è¿›é˜¶ç§˜ç±','ç‹¬å­¤ä¹å‰‘è¿›é˜¶ç§˜ç±','ä¹é˜´ç™½éª¨çˆªè¿›é˜¶ç§˜ç±','è¯¸å¤©åŒ–èº«æ­¥è¿›é˜¶ç§˜ç±','ä¸´æµåäºŒåº„è¿›é˜¶ç§˜ç±','å€šå¤©å‰‘æ³•è¿›é˜¶ç§˜ç±','ä¸€æŒ‡ç¦…è¿›é˜¶ç§˜ç±','ä¸€è‹‡æ¸¡æ±Ÿè¿›é˜¶ç§˜ç±','ç‡ƒæœ¨åˆ€æ³•è¿›é˜¶ç§˜ç±','é‡‘åˆšä¸åä½“è¿›é˜¶ç§˜ç±','åŒ—å†¥ç¥åŠŸè¿›é˜¶ç§˜ç±','å¤©å±±å…­é˜³æŒè¿›é˜¶ç§˜ç±','å‡Œæ³¢å¾®æ­¥è¿›é˜¶ç§˜ç±','å°æ— ç›¸åŠŸè¿›é˜¶ç§˜ç±','ç©¿å¿ƒæŒè¿›é˜¶ç§˜ç±','æ€ç”Ÿå†³è¿›é˜¶ç§˜ç±','è¸é›ªå¯»æ¢…è¿›é˜¶ç§˜ç±','æ¼«å¤©èŠ±é›¨è¿›é˜¶ç§˜ç±'

// é¢„å¤‡
stopstate
[if] (:room) != ä½æˆ¿-å§å®¤
  jh fam 0 start;go west;go west;go north;go enter
  go north
store
@dialog

// æ•´ç†
@cmdDelay 800
($lvNow) = 7
[while] (lvNow) >= 0
  [if] (lvNow)==7 && (tidyM)==æ˜¯
    ($bookNow)=(bookM)
  [else if] (lvNow)==6 && (tidyR)==æ˜¯
    ($bookNow)=(bookR)
  [else if] (lvNow)==5 && (tidyO)==æ˜¯
    ($count)=200
    ($bookNow)=(bookO)
  [else if] (lvNow)==4 && (tidyP)==æ˜¯
    ($count)=100
    ($bookNow)=(bookP)
  [else if] (lvNow)==3 && (tidyY)==æ˜¯
    ($count)=50
    ($bookNow)=(bookY)
  [else if] (lvNow)==2 && (tidyB)==æ˜¯
    ($count)=30
    ($bookNow)=(bookB)
  [else if] (lvNow)==1 && (tidyG)==æ˜¯
    ($count)=10
    ($bookNow)=(bookG)
  [else if] (lvNow)==0 && (tidyW)==æ˜¯
    ($bookNow)=(bookW)
  [else]
    ($lvNow) = (lvNow) - 1
    [continue]
  
  //@print ç­‰çº§(lvNow)ï¼Œæ•°é‡(count)
  @js ($len) = [(bookNow)].length
  //@print (len)
  ($num) = 0
  [while] (num) < (len)
    @js ($book) = [(bookNow)][(num)]
    @print (book)
    ($cmd1) = null
    [if] (lvNow)==7 || (lvNow)==6 || (lvNow)==0
      [if] {d(book)#}? == 1
        qu {d(book)}?
      [else if] {d(book)#}? != null
        qu {d(book)#}? {d(book)}?
      [else]
        ($num) = (num) + 1
        [continue]
      [if] {b(book)#}? == 1
        sj store {b(book)}?
      [else if] {b(book)#}? != null
        sj store {b(book)#}? {b(book)}?
    [else]
      // æ ¹æ®ä¸åŒé¢œè‰²ç§˜ç±åˆæˆæ•°è®¡ç®—æ•°é‡
      ($bookPage) = {d(book)æ®‹é¡µ#}?
      //@print (book)æ®‹é¡µæ•°é‡ï¼š(bookPage)
      [if] (bookPage) != null
        @js ($bookNum) = parseInt((bookPage)/(count))
      [if] (bookNum) > 0 && (bookNum) != null && (bookPage) != null
        //@print å¯åˆæˆæ•°é‡ï¼š(bookNum)
        ($pageNum) = (bookNum)*(count)
        qu (pageNum) {d(book)æ®‹é¡µ}?
        combine {b(book)æ®‹é¡µ}? (bookNum)
        [if] {d(book)ç§˜ç±}? != null
          qu {d(book)ç§˜ç±#}? {d(book)ç§˜ç±}?
      [if] {b(book)ç§˜ç±}? != null
        sj store {b(book)ç§˜ç±#}? {b(book)ç§˜ç±}?
      [else]
        ($num) = (num) + 1
        [continue]
    @tip æ”¾åˆ°ä¹¦æ¶ä¸Šé¢|ä½ çš„ä¹¦æ¶($full)æ”¾æ»¡äº†
    [if] (full) != null
      @tm ä¹¦æ¶å·²æ»¡ï¼Œæ— æ³•å­˜æ”¾ã€‚
      @print <hiy>ä¹¦æ¶å·²æ»¡ï¼Œæ— æ³•å­˜æ”¾ã€‚</hiy>
      @tidyBag
      @await 2000
      $zdwk
      [exit]
    ($num) = (num) + 1
  
  ($lvNow) = (lvNow) - 1
$zdwk