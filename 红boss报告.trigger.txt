//~silent
// æŸ¥è¯¢Boss
// è°£è¨€æ›´æ–°æˆ–ä»»æ„é¢‘é“ï¼ˆæˆ¿é—´é™¤å¤–ï¼‰å‘é€ b å³å¯å‡ºç°ç›¸å…³ä¿¡æ¯
// ç‚¹å‡» å‚æ•°è®¾ç½® æŒ‰é’®å¯è®¾ç½®Bossç±»å‹
($changeLog) = æ–°å¢ã€åªæ‰“ç»„é˜Ÿæœ¬ã€‘å’Œã€Bossåˆ·æ–°å‘å£°æé†’ã€‘åŠŸèƒ½ï¼›æ–°å¢ã€è·³è¿‡å¤©åƒ§åºæ–‘ã€‘é€‰é¡¹ã€‚
($localVer) = 2021030301
[if] (BossModel) == null
  ($BossModel) = è‡ªåŠ¨è·³è¿‡å¤©åƒ§
($bossSet) = (BossModel)
[if] (BossTeam) == null
  ($BossTeam) = å…³é—­
[if] (BossTeam) == å¼€å¯
  ($bossSet) = (bossSet)ï¼›åªæ‰“ç»„é˜Ÿæœ¬
[if] (BossPost) == null
  ($BossPost) = æ¸¸æˆä¿¡æ¯åŒº
[if] (BossPost) == æ¸¸æˆä¿¡æ¯åŒº
  ($comClass) = content-message
  ($magPost) = 1
[else] (BossPost) == æ’ä»¶ä¿¡æ¯åŒº
  ($comClass) = WG_log
  ($magPost) = 0
[if] (BossAlert) == null
  ($BossAlert) = å…³é—­

[if] (:state) == é—­å…³
  ($action) = $zdwk
[else if] (:state) == ç»ƒä¹ 
  ($action) = dazuo
[if] (content)==boss || (content)==b
  [if] (name)==(:name)
    ($mycall) = true
    @toolbar jh
    @toolbar tasks
    @await 350
    @task æŒ‘æˆ˜æ­¦ç¥BOSS($num)æ¬¡|ä»Šæ—¥å¯é¢†å–
    ($remain)=âš”ï¸ æœ¬å‘¨è¿˜å¯æŒ‘æˆ˜(num)æ¬¡
    [if] (num)==null
      ($BossInfo) = null
      ($log) = âœ… æœ¬å‘¨å·²æ‰“å®Œ5æ¬¡Boss\nâš™ï¸ å½“å‰è®¾ç½®ï¼š(bossSet)
      @js messageAppend("(log)",2,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss boss-setting">âš™ï¸ è®¾ç½®å‚æ•°</span>`)));$('.(comClass)')[0].scrollTop = 99999;
      //æŒ‰é’®å‘½ä»¤
      @js $(".redboss").off("click")
      @js $(".boss-setting").on("click", function(){ToRaid.perform(`//~silent\n#select ($BossModel)=Bossç±»å‹,æˆ‘å…¨éƒ½è¦|è‡ªåŠ¨è·³è¿‡å¤©åƒ§|è·³è¿‡å¤©åƒ§åºæ–‘|åªæ‰“æµªç¿»äº‘çƒ›ä¹é˜´|åªæ‰“æµªç¿»äº‘|åªæ‰“çƒ›ä¹é˜´|åªæ‰“èš©å°¤|åªæ‰“åºæ–‘,(BossModel)\n#select ($BossTeam)=åªæ‰“ç»„é˜Ÿæœ¬,å…³é—­|å¼€å¯,(BossTeam)\n#select ($BossPost)=Bossä¿¡æ¯æ˜¾ç¤ºä½ç½®,æ¸¸æˆä¿¡æ¯åŒº|æ’ä»¶ä¿¡æ¯åŒº,(BossPost)\n#select ($BossAlert)=Bossåˆ·æ–°æ—¶å‘å£°æé†’ï¼ˆæç¤ºéŸ³éœ€Raidç‰ˆæœ¬è‡³å°‘ä¸º2.4.40ï¼‰,å…³é—­|æç¤ºéŸ³|è¯­éŸ³æ’­æŠ¥,(BossAlert)\n#config\ntm b`);})
      [exit]
    [if] (BossInfo) != null
      @js ($info)=("\""+"(BossInfo)"+"\"").replace(/\|/g,"\"|\"").split("|")
      @js ($i_date)=[(info)][0]
      @js ($i_time)=[(info)][1]
      @js ($bossName)=[(info)][2]
      @js ($bossPlace)=[(info)][3]
    [else]
      ($i_date) = null
    [if] (i_date) != (:date) || (bossName) == null || (bossPlace) == null
      ($i_time)=null
      [if] (i_date) == notime
        ($log) = ğŸ” å·²è·³è¿‡æˆ–æ‰“è¿‡ä¸Šä¸€ä¸ªBossï¼Œå‰å¾€å®¢æ ˆè·å–æœ€æ–°ä¿¡æ¯â€¦â€¦
      [else]
        ($log) = ğŸ” æ— ä»Šæ—¥æ•°æ®ï¼Œå‰å¾€å®¢æ ˆè·å–â€¦â€¦
      @js messageAppend("(log)",1,(magPost));
      [if] (:state) == æ¨æ¼” || (:room å‰¯æœ¬åŒºåŸŸ) == true
        [(:state) == æ¨æ¼”]($log) = âš ï¸ æ¨æ¼”ä¸­ï¼Œæš‚åœå‰å¾€å®¢æ ˆè·å–ä¿¡æ¯ã€‚
        [(:room å‰¯æœ¬åŒºåŸŸ) == true]($log) = âš ï¸ å‰¯æœ¬ä¸­ï¼Œæš‚åœå‰å¾€å®¢æ ˆè·å–ä¿¡æ¯ã€‚
        @js messageAppend("<ord>(log)</ord>",1,(magPost));$('.(comClass)')[0].scrollTop = 99999;
        [exit]
      stopstate
      [while] (:room) != æ‰¬å·åŸ-æœ‰é—´å®¢æ ˆ
        $to æ‰¬å·åŸ-æœ‰é—´å®¢æ ˆ
        @await 500
      //dating {råº—å°äºŒ}?
      give {råº—å°äºŒ}? 20000 money
      @tip è¿™ä½å®¢å®˜ï¼Œæˆ‘æœ€è¿‘å¬ä¸å°‘äººè¯´æ˜¯åœ¨($bossPlace)è§åˆ°è¿‡($bossName)ã€‚|è¿™ä¸¤å¤©ä¹Ÿ($notime)ä»€ä¹ˆæ¶ˆæ¯|å°çš„å¬åˆ°çš„æ¶ˆæ¯($all)æ‚¨è€äº†
    [if] (notime) != null || (all) != null
      [if] (notime) != null
        ($log) = â³ Bosså°šæœªåˆ·æ–°ï¼Œè¯·ç¨åå†è¯•\nâš™ï¸ å½“å‰è®¾ç½®ï¼š(bossSet)\n(remain)</ord>
      [else if] (all) != null
        ($log) = <hig>âœ… æœ¬å‘¨å·²æ‰“å®Œ5æ¬¡Boss\nâš™ï¸ å½“å‰è®¾ç½®ï¼š(bossSet)</hig>
      @js messageAppend("(log)",1,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss boss-setting">âš™ï¸ è®¾ç½®å‚æ•°</span>`)));
      (action)
  [else]
    [exit]
// è°£è¨€è·å–Boss
[else if] (channel)==è°£è¨€
  @js ($bossName) = "(content)".match("å¬è¯´([^%]+)å‡ºç°åœ¨")[1]
  @js ($bossPlace) = "(content)".match("å‡ºç°åœ¨([^%]+)ä¸€å¸¦ã€‚")[1]
  @toolbar jh
  @toolbar tasks
  @await 350
  @task æŒ‘æˆ˜æ­¦ç¥BOSS($num)æ¬¡|ä»Šæ—¥å¯é¢†å–
  ($remain)=âš”ï¸ æœ¬å‘¨è¿˜å¯æŒ‘æˆ˜(num)æ¬¡
// å¤„ç†å‚æ•°
[if] (bossName) == æˆ˜ç¥èš©å°¤
  ($bossName) = èš©å°¤
[if] (bossPlace) != null && (bossName) != null
  [if] (i_time) == null
    ($BossInfo)=(:date)|(:hour):(:minute):(:second)|(bossName)|(bossPlace)
  //@js messageAppend("<ord>(BossInfo)\n(remain)</ord>",1,(magPost));
  ($fbdata) = "æ ‘æ—":"cr yz/lw/shangu 0","è´¢ä¸»å®¶":"cr yz/cuifu/caizhu 1","ä¸½æ˜¥é™¢":"cr yz/lcy/dating 0","æµæ°“å··":"cr yz/lmw/xiangzi1 0","å…µè¥":"cr yz/by/damen 0","åº„åºœ":"cr bj/zhuang/xiaolu 0","é³Œæ‹œåºœ":"cr bj/ao/damen 0","å¤©åœ°ä¼š":"cr bj/tdh/hct 0","ç¥é¾™æ•™":"cr bj/shenlong/haitan 0","å…³å¤–":"cr bj/guanwai/damen 0","æ¸©åºœ":"cr cd/wen/damen 0","äº”æ¯’æ•™":"cr cd/wudu/damen 0","æ’å±±":"cr wuyue/hengshan/daziling 0","é’åŸå±±":"cr wuyue/qingcheng/shanlu 0","è¡¡å±±":"cr wuyue/henshan/hengyang 0","æ³°å±±":"cr wuyue/taishan/daizong 0","åµ©å±±":"cr wuyue/songshan/taishi 0","äº‘æ¢¦æ²¼æ³½":"cr cd/yunmeng/senlin 0","æ¡ƒèŠ±å²›":"cr taohua/haitan 1","ç™½é©¼å±±":"cr baituo/damen 0","æ˜Ÿå®¿æµ·":"cr xingxiu/xxh6 0","å†°ç«å²›":"cr mj/bhd/haibian 1","ç§»èŠ±å®«":"cr huashan/yihua/shandao 1","ç‡•å­å":"cr murong/anbian 1","é»‘æœ¨å´–":"cr heimuya/shangu 0","ç¼¥ç¼ˆå³°":"cr lingjiu/shanjiao 1","å…‰æ˜é¡¶":"cr mj/shanmen 0","å¤©é¾™å¯º":"cr tianlong/damen 1","è¡€åˆ€é—¨":"cr xuedao/shankou 0","å¤å¢“æ´¾":"cr gumu/gumukou 1","åå±±è®ºå‰‘":"cr huashan/lunjian/leitaixia 0"
  @js ($fbcr) = var fb={(fbdata)};fb.(bossPlace)
  [if] (bossPlace)==æµæ°“å·· || (bossPlace)==ç¥é¾™æ•™ || (bossPlace)==äº”æ¯’æ•™ || (bossPlace)==äº‘æ¢¦æ²¼æ³½ || (bossPlace)==ç™½é©¼å±± || (bossPlace)==å†°ç«å²› || (bossPlace)==ç§»èŠ±å®« || (bossPlace)==é»‘æœ¨å´– || (bossPlace)==å…‰æ˜é¡¶ || (bossPlace)==è¡€åˆ€é—¨
    ($team) = true
// ç”Ÿæˆå¿«æ·æŒ‰é’®
[if] (fbcr) != null
  [if] (:state) == æ¨æ¼”
    ($log) = <ord>âš ï¸ æ¨æ¼”ä¸­ï¼Œè¯·æ³¨æ„æ“ä½œï¼</ord>
    @js messageAppend("(log)",1,(magPost));
  [if] (:state) == é—­å…³ || (:state) == ç»ƒä¹  || (:room) == æ‰¬å·åŸ-æœ‰é—´å®¢æ ˆ
    [if] (bossName) != æµªç¿»äº‘ && (BossModel) == åªæ‰“æµªç¿»äº‘
      ($model) = true
    [else if] (bossName) != çƒ›ä¹é˜´ && (BossModel) == åªæ‰“çƒ›ä¹é˜´
      ($model) = true
    [else if] (bossName) != èš©å°¤ && (BossModel) == åªæ‰“èš©å°¤
      ($model) = true
    [else if] (bossName) != åºæ–‘ && (BossModel) == åªæ‰“åºæ–‘
      ($model) = true
    [else if] (bossName) != æµªç¿»äº‘ && (bossName) != çƒ›ä¹é˜´ && (BossModel) == åªæ‰“æµªç¿»äº‘çƒ›ä¹é˜´
      ($model) = true
    [else if] (bossName) != æµªç¿»äº‘ && (bossName) != çƒ›ä¹é˜´ && (bossName) != èš©å°¤ && (BossModel) == è·³è¿‡å¤©åƒ§åºæ–‘
      ($model) = true
    [else if] (bossName) == å¤©åƒ§ && (BossModel) == è‡ªåŠ¨è·³è¿‡å¤©åƒ§
      ($model) = true
  [if] (BossTeam) == å¼€å¯ && (team) != true
    ($model) = true
  [if] (model) == true
    ($log) = <ord>ğŸ’ (BossInfo)\n<hiy>âš ï¸ æ ¹æ®è®¾ç½®<ord>ã€(bossSet)ã€‘</ord>ï¼Œè‡ªåŠ¨è·³è¿‡å½“å‰Boss(bossName)</hiy>\n(remain)</ord>
    @js messageAppend("(log)",1,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss boss-setting">âš™ï¸ è®¾ç½®å‚æ•°</span>`)));
    team out;stopstate;(fbcr) 0;cr over;$wait 1000;(action)
    ($BossInfo)=notime
  [else]
    [if] (bossPlace)==æµæ°“å·· || (bossPlace)==ç¥é¾™æ•™ || (bossPlace)==äº”æ¯’æ•™ || (bossPlace)==äº‘æ¢¦æ²¼æ³½ || (bossPlace)==ç™½é©¼å±± || (bossPlace)==å†°ç«å²› || (bossPlace)==ç§»èŠ±å®« || (bossPlace)==é»‘æœ¨å´– || (bossPlace)==å…‰æ˜é¡¶ || (bossPlace)==è¡€åˆ€é—¨
      @js ($fbcr2) = var f="(fbcr)";f=f.substr(0,f.length-1)+"2"
      @js messageAppend("<ord>ğŸ’ (BossInfo)\nâš™ï¸ å½“å‰è®¾ç½®ï¼š(bossSet)\n(remain)</ord>",1,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss boss-single">ğŸ¥• è¿›å…¥ <hic>(bossPlace)</hic> => <ord>å¯»æ‰¾Boss</ord></span>`),$(`<span class="redboss boss-team">ğŸšŒ è¿›å…¥ <hic>(bossPlace)(<hiy>ç»„é˜Ÿ</hiy>)</hic> => <ord>å¯»æ‰¾Boss</ord></span>`),$(`<span class="redboss boss-skip">ğŸ¥š è¿›å‡º <hic>(bossPlace)</hic> => <hig>åˆ·æ–°Boss</hig></span>`),$(`<span class="redboss boss-refresh">ğŸ™‰ å‰å¾€å®¢æ ˆåˆ·æ–°</span>`),$(`<span class="redboss boss-setting">âš™ï¸ è®¾ç½®å‚æ•°</span>`)))
    [else]
      @js messageAppend("<ord>ğŸ’ (BossInfo)\nâš™ï¸ å½“å‰è®¾ç½®ï¼š(bossSet)\n(remain)</ord>",1,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss boss-single">ğŸ¥• è¿›å…¥ <hic>(bossPlace)</hic> => <ord>å¯»æ‰¾Boss</ord></span>`),$(`<span class="boss-skip">ğŸ¥š è¿›å‡º <hic>(bossPlace)</hic> => <hig>åˆ·æ–°Boss</hig></span>`),$(`<span class="redboss boss-refresh">ğŸ™‰ å‰å¾€å®¢æ ˆåˆ·æ–°</span>`),$(`<span class="redboss boss-setting">âš™ï¸ è®¾ç½®å‚æ•°</span>`)))
    [if] (channel) == è°£è¨€
      [if] (BossAlert) == æç¤ºéŸ³
        @beep
      [else if] (BossAlert) == è¯­éŸ³æ’­æŠ¥
        $tts (:name)ï¼Œ(bossName)å‡ºç°åœ¨(bossPlace)ã€‚
//æŒ‰é’®å‘½ä»¤
[if] (mycall) == true || (channel) == è°£è¨€
  @js $(".redboss").off("click")
  @js $(".boss-single").on("click", function(){ToRaid.perform(`//~silent\nstopstate;(fbcr) 0\n($BossInfo)=notime\n@js messageAppend("ğŸ¥• è¿›å…¥å•äººå‰¯æœ¬ <hic>(bossPlace)</hic> => <ord>(bossName)</ord>",2,(magPost));$('.(comClass)')[0].scrollTop = 99999;`);})
  @js $(".boss-team").on("click", function(){ToRaid.perform(`//~silent\nstopstate;(fbcr2) 0\n($BossInfo)=notime\n@js messageAppend("ğŸšŒ è¿›å…¥ç»„é˜Ÿå‰¯æœ¬ <hic>(bossPlace)</hic> => <ord>(bossName)</ord>",2,(magPost));$('.(comClass)')[0].scrollTop = 99999;`);})
  @js $(".boss-skip").on("click", function(){ToRaid.perform(`//~silent\nteam out;stopstate;(fbcr) 0;cr over;$wait 1000;(action)\n($BossInfo)=notime\n@js messageAppend("ğŸ¥š å·²è·³è¿‡<ord>(bossName)</ord>ï¼",1,(magPost));$('.(comClass)')[0].scrollTop = 99999;`);})
  @js $(".boss-refresh").on("click", function(){ToRaid.perform(`($BossInfo)=null\ntm b`);})
  @js $(".boss-setting").on("click", function(){ToRaid.perform(`//~silent\n#select ($BossModel)=Bossç±»å‹,æˆ‘å…¨éƒ½è¦|è‡ªåŠ¨è·³è¿‡å¤©åƒ§|è·³è¿‡å¤©åƒ§åºæ–‘|åªæ‰“æµªç¿»äº‘çƒ›ä¹é˜´|åªæ‰“æµªç¿»äº‘|åªæ‰“çƒ›ä¹é˜´|åªæ‰“èš©å°¤|åªæ‰“åºæ–‘,(BossModel)\n#select ($BossTeam)=åªæ‰“ç»„é˜Ÿæœ¬,å…³é—­|å¼€å¯,(BossTeam)\n#select ($BossPost)=Bossä¿¡æ¯æ˜¾ç¤ºä½ç½®,æ¸¸æˆä¿¡æ¯åŒº|æ’ä»¶ä¿¡æ¯åŒº,(BossPost)\n#select ($BossAlert)=Bossåˆ·æ–°æ—¶å‘å£°æé†’ï¼ˆæç¤ºéŸ³éœ€Raidç‰ˆæœ¬è‡³å°‘ä¸º2.4.40ï¼‰,å…³é—­|æç¤ºéŸ³|è¯­éŸ³æ’­æŠ¥,(BossAlert)\n#config\ntm b`);})
  //æ£€æŸ¥ç‰ˆæœ¬
  ($repourl) = https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script
  @js ($version) = $.ajax({type: "GET", url: "(repourl)/version.txt", async: false, cache: false}).responseText;
  @js ($remoteVer) = var v = (version);v.rboss
  @js ($rVer) = [(remoteVer)][0]
  [if] (localVer) < (rVer) && (remoteVer) != null
    @js ($newT) = [(remoteVer)][1]
    @js messageAppend("<ord>æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼</ord>",1,(magPost));$('.(comClass) pre').append($(`<div class="item-commands"></div>`).append($(`<span class="redboss update">â™»ï¸ æ›´æ–° => <hig>çº¢bossæŠ¥å‘Š</hig></span>`)))
    @js $(".update").on("click", function(){ToRaid.perform(`//~silent\n@js unsafeWindow.TriggerCenter.remove("çº¢bossæŠ¥å‘Š")\n@await 350\n@js Server.importTrigger("(newT)")`);})
  @js $('.(comClass)')[0].scrollTop = 99999;