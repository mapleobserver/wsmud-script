//~silent
//åŸºäºåŸç‰ˆä¿®æ”¹
($localVer) = 2021030302
($changeLog) = æ–°å¢é‡é€‰è¯æ¡åŠŸèƒ½ï¼Œæ–¹ä¾¿è°ƒæ•´è¯æ¡å†…å®¹ã€‚
($flowName) = è‡ªåˆ›æ¨æ¼”
($repourl) = https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script
@js ($version) = $.ajax({type: "GET", url: "(repourl)/version.txt", async: false, cache: false}).responseText;
//@print (version)
@js ($remoteVer) = var v = (version);v.zcty
[if] (localVer) < (remoteVer) && (remoteVer) != null
  @js WG.SendCmd("tm å½“å‰(flowName)ç‰ˆæœ¬ã€(localVer)ã€‘ï¼Œå°†å¼€å§‹è‡ªåŠ¨æ›´æ–°è‡³æœ€æ–°ã€(remoteVer)ã€‘ã€‚")
  ($f_ss)={"name":"(flowName)","source":"(repourl)/(flowName).flow.txt","finder":"æ ¹æ–‡ä»¶å¤¹"}
  @js var time = Date.parse( new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
  @wait 1500
  ($log) = (flowName)å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆã€(remoteVer)ã€‘ï¼Œå³å°†è‡ªåŠ¨è¿è¡Œã€‚
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>
  @js var f=(f_ss);ManagedPerformerCenter.start(f["name"], FlowStore.get(f["name"]));
  [exit]
[else]
  [if] (remoteVer) == null
    ($log) = è·å–è¿œç¨‹ç‰ˆæœ¬å¤±è´¥ï¼Œç»´æŒå½“å‰ç‰ˆæœ¬ä¸å˜ã€‚
  [else]
    ($log) = å¼€å§‹è¿è¡Œ(flowName)ï¼Œå½“å‰ç‰ˆæœ¬ã€(remoteVer)ã€‘ã€‚æ›´æ–°å†…å®¹ï¼š(changeLog)
  @js WG.SendCmd("tm (log)")
  @print <ord>(log)</ord>

@cmdDelay 0
[if] (ZCFood) == null
  ($ZCFood)=æ˜¯
[if] (ZCFy) == null
  ($ZCFy)=æ˜¯
[if] (ZCSkill) == null
  ($ZCSkill)=å†…åŠŸ
[if] (ZCNum) == null
  ($ZCNum)=4
[if] (ZCMaxqn) == null
  ($ZCMaxqn)=100000
[if] (ZCProp) == null
  ($ZCProp)=å¿½è§†å¯¹æ–¹é˜²å¾¡|æœ€ç»ˆä¼¤å®³|æš´å‡»|ç»æ‹›å†·å´æ—¶é—´%
[if] (ZCSpc) == null
  ($ZCSpc)=çŸ­æ—¶é—´æ— è§†ä¼¤å®³
[if] (ZCXlu) == null
  ($ZCXlu)=æ— 

#select ($zcEntry)=<hiz>é‡æ–°è®¾å®šè¯æ¡ï¼ˆå¼€å¯å‰å…ˆé€‰æ‹©æ¨æ¼”éƒ¨ä½ğŸ‘‡ï¼‰</hiz>,å¼€å¯|å…³é—­,å…³é—­
#select ($ZCSkill)=è¦æ¨æ¼”çš„æŠ€èƒ½éƒ¨ä½,å†…åŠŸ|é­æ³•|æ£æ³•|å‰‘æ³•|åˆ€æ³•|æ–æ³•|æ‹›æ¶|æ‹³è„š|æš—å™¨|è½»åŠŸ,(ZCSkill)
#select ($ZCFood)=å†°å¿ƒ,æ˜¯|å¦,(ZCFood)
#select ($ZCFy)=é£ç¿¼,æ˜¯|å¦,(ZCFy)
#input ($ZCProp)=æ™®é€šè¯æ¡(å®Œå…¨åŒ¹é…ï¼Œ|éš”å¼€ï¼Œé™å®šåªæ‹¿ç™¾åˆ†æ¯”åé¢åŠ %),(ZCProp)
#input ($ZCSpc)=ç‰¹æ®Šè¯æ¡(æ¨¡ç³ŠåŒ¹é…),(ZCSpc)
#select ($ZCXlu)=é¦™ç‚‰,æ— |æ²‰é¦™æœ¨é¼|éºé¦™é“œé¼|é¾™æ¶é¦™ç†|é¾™è„‘å¤é¼,(ZCXlu)
#input ($ZCNum)=è®¡æ•°,(ZCNum)
#input ($ZCMaxqn)=æ€»æ¶ˆè€—æ½œèƒ½(ä¸‡),(ZCMaxqn)
#config

[if] (zcEntry)==å¼€å¯
  [if] (ZCSkill)==å†…åŠŸ
    ($propAry)=è‡‚åŠ›|å‘½ä¸­|æ”»å‡»%|å‘½ä¸­%|æœ€ç»ˆä¼¤å®³%|å¿½è§†å¯¹æ–¹é˜²å¾¡%|ç»æ‹›å†·å´%|æš´å‡»%|ç»ƒä¹ æ•ˆç‡%|æ”»é€Ÿ%|å†…åŠ›æ¶ˆè€—%|ä¼¤å®³å‡å…%|é˜²å¾¡%|æ‹›æ¶%|èº²é—ª%|æ°”è¡€%|æš´å‡»ä¼¤å®³%|æš´å‡»æŠµæŠ—%|å¿™ä¹±%|å¿½è§†å¿™ä¹±%|ç»æ‹›é‡Šæ”¾%|å­¦ä¹ æ•ˆç‡%|æ‰“åæ•ˆç‡%|æ”»å‡»|ç»æ‹›å†·å´|æ”»é€Ÿ|ç»æ‹›é‡Šæ”¾|å¿™ä¹±|æ ¹éª¨|èº«æ³•|æ‚Ÿæ€§|é˜²å¾¡|æ‹›æ¶|èº²é—ª
    ($spcAry)=å¸è¡€ï¼ˆå¤ªç„ï¼‰|ä¸ç­ï¼ˆæ··æ²Œï¼‰|æˆ˜ç¥|åéœ‡|å®ˆæŠ¤|å‰‘å¿ƒ
  [else if] (ZCSkill)==é­æ³• || (ZCSkill)==æ£æ³• || (ZCSkill)==å‰‘æ³• || (ZCSkill)==åˆ€æ³• || (ZCSkill)==æ–æ³• || (ZCSkill)==æ‹³è„š || (ZCSkill)==æš—å™¨
    ($propAry)=æ”»å‡»|å‘½ä¸­|è‡‚åŠ›|æ”»å‡»%|å‘½ä¸­%|æœ€ç»ˆä¼¤å®³%|å¿½è§†å¯¹æ–¹é˜²å¾¡%|æš´å‡»%|å†…åŠ›æ¶ˆè€—%|ä¼¤å®³å‡å…%|é˜²å¾¡%|æ‹›æ¶%|èº²é—ª%|æ°”è¡€%|æš´å‡»ä¼¤å®³%|æš´å‡»æŠµæŠ—%|å¿™ä¹±%|å¿½è§†å¿™ä¹±%|æ ¹éª¨|èº«æ³•|æ‚Ÿæ€§|é˜²å¾¡|æ‹›æ¶|èº²é—ª
    ($spcAry)=å¼±åŒ–|æº…å°„|å¸è¡€|ç©¿é€|æ— æƒ…|å—œè¡€|å†…ä¼¤ï¼ˆå…¥é­”ï¼‰
  [else if] (ZCSkill)==æ‹›æ¶
    ($propAry)=æ”»å‡»|å‘½ä¸­|è‡‚åŠ›|å‘½ä¸­%|æ ¹éª¨|èº«æ³•|æ‚Ÿæ€§|é˜²å¾¡|æ‹›æ¶|èº²é—ª|æš´å‡»ä¼¤å®³%|å†…åŠ›æ¶ˆè€—%|ç»ƒä¹ æ•ˆç‡%|å­¦ä¹ æ•ˆç‡%|æ‰“åæ•ˆç‡%|é˜²å¾¡%|æ‹›æ¶%|èº²é—ª%|æ°”è¡€%
    ($spcAry)=åå‡»ï¼ˆç§»èŠ±ï¼‰|ä¹¾å¤|çºµæ¨ª
  [else if] (ZCSkill)==è½»åŠŸ
    ($propAry)=æ”»å‡»|è‡‚åŠ›|å‘½ä¸­|å‘½ä¸­%|é˜²å¾¡|æ‹›æ¶|èº²é—ª|æ ¹éª¨|èº«æ³•|æ‚Ÿæ€§|é˜²å¾¡%|æ‹›æ¶%|èº²é—ª%|æ°”è¡€%|æš´å‡»ä¼¤å®³%|å†…åŠ›æ¶ˆè€—%|ç»ƒä¹ æ•ˆç‡%|å­¦ä¹ æ•ˆç‡%|æ‰“åæ•ˆç‡%
    ($spcAry)=åå‡»|çµåŠ¨|ä¸“æ³¨
  #input ($info)= <hiz>å½“å‰é€‰æ‹©éƒ¨ä½ï¼š</hiz><ord>ğŸ‘‰(ZCSkill)ğŸ‘ˆ</ord>,ğŸ±
  #select ($entry1)=æ™®é€šè¯æ¡1,(propAry),(entry1)
  #select ($entry2)=æ™®é€šè¯æ¡2,(propAry),(entry2)
  #select ($entry3)=æ™®é€šè¯æ¡3,(propAry),(entry3)
  #select ($entry4)=æ™®é€šè¯æ¡4,(propAry),(entry4)
  #select ($entry5)=æ™®é€šè¯æ¡5ï¼ˆæœ‰ç‰¹æ®Šè¯æ¡å¯é€‰æ— ï¼‰,æ— |(propAry),(entry5)
  #select ($entryspc)=ç‰¹æ®Šè¯æ¡ï¼ˆä¸éœ€è¦åˆ™é€‰æ— ï¼‰,æ— |(spcAry),(entryspc)
  #config
  ($ZCProp) = (entry1)|(entry2)|(entry3)|(entry4)
  [if] (entry5) != æ— 
    ($ZCProp) = (ZCProp)|(entry5)
  [if] (entryspc)==æ—  || (entryspc)==null
    ($ZCSpc) = null
  [else]
    [if] (entryspc)==å¸è¡€ï¼ˆå¤ªç„ï¼‰
      ($ZCSpc)=æ”»å‡»åŠ›çš„å†…åŠŸä¼¤å®³
    [else if] (entryspc)==ä¸ç­ï¼ˆæ··æ²Œï¼‰
      ($ZCSpc)=çŸ­æ—¶é—´æ— è§†ä¼¤å®³
    [else if] (entryspc)==æˆ˜ç¥
      ($ZCSpc)=ç©ºæ‰‹æ—¶é™„åŠ çš„å†…åŠ›åŠ å€
    [else if] (entryspc)==åéœ‡
      ($ZCSpc)=æœ€å¤§å†…åŠ›çš„åéœ‡ä¼¤å®³
    [else if] (entryspc)==å®ˆæŠ¤
      ($ZCSpc)=æ°”è¡€æ¯é™ä½
    [else if] (entryspc)==å‰‘å¿ƒ
      ($ZCSpc)=é¢å¤–æ”»å‡»æ•Œäºº
    [else if] (entryspc)==å¼±åŒ–
      ($ZCSpc)=æˆ˜æ–—å±æ€§
    [else if] (entryspc)==æº…å°„
      ($ZCSpc)=å¯¹é™„è¿‘ä¸€åæ•Œäºº
    [else if] (entryspc)==å¸è¡€
      ($ZCSpc)=è½¬åŒ–ä¸ºè‡ªèº«æ°”è¡€
    [else if] (entryspc)==ç©¿é€
      ($ZCSpc)=ä¼¤å®³å¢åŠ 
    [else if] (entryspc)==æ— æƒ…
      ($ZCSpc)=æ•Œäººçš„æ°”è¡€æ¯é™ä½
    [else if] (entryspc)==å—œè¡€
      ($ZCSpc)=ä½ çš„æ°”è¡€æ¯é™ä½
    [else if] (entryspc)==å†…ä¼¤ï¼ˆå…¥é­”ï¼‰
      ($ZCSpc)=é™„åŠ ä½ æœ€å¤§å†…åŠ›
    [else if] (entryspc)==åå‡»ï¼ˆç§»èŠ±ï¼‰
      ($ZCSpc)=æ‹›æ¶æˆåŠŸåé¡ºåŠ¿åå‡»æ•Œäºº
    [else if] (entryspc)==ä¹¾å¤
      ($ZCSpc)=ä¼¤å®³å‡å…
    [else if] (entryspc)==çºµæ¨ª
      ($ZCSpc)=æ‹›æ¶æˆåŠŸåå¢åŠ 
    [else if] (entryspc)==åå‡»
      ($ZCSpc)=èº²é—ªæˆåŠŸåé¡ºåŠ¿åå‡»æ•Œäºº
    [else if] (entryspc)==çµåŠ¨
      ($ZCSpc)=èº²é—ªæˆåŠŸåå¢åŠ 
    [else if] (entryspc)==ä¸“æ³¨
      ($ZCSpc)=æˆ˜æ–—ä¸­æå‡èº²é—ª
  @js ManagedPerformerCenter.start("è‡ªåˆ›æ¨æ¼”", FlowStore.get("è‡ªåˆ›æ¨æ¼”"));
  [exit]


($skill)=force
[if] (ZCSkill) == é­æ³•
   ($skill)=whip
[else if] (ZCSkill) == æ–æ³•
   ($skill)=staff
[else if] (ZCSkill) == æ‹›æ¶
   ($skill)=parry
[else if] (ZCSkill) == æ‹³è„š
   ($skill)=unarmed
[else if] (ZCSkill) == æš—å™¨
   ($skill)=throwing
[else if] (ZCSkill) == è½»åŠŸ
   ($skill)=dodge
[else if] (ZCSkill) == æ£æ³•
   ($skill)=club
[else if] (ZCSkill) == å‰‘æ³•
   ($skill)=sword
[else if] (ZCSkill) == åˆ€æ³•
   ($skill)=blade

($max)=(ZCMaxqn)*10000

[if](ZCProp)!=null&&(ZCProp)!=none
  @js ($zcp)=("\""+"(ZCProp)"+"\"").replace(/\|/g,"\"|\"").split("|")

stopstate
[if] (ZCXlu)!=æ—  && {b(ZCXlu)}? != null
  use {b(ZCXlu)}?
($sum)=0
[while] true
  [if] (ZCFood) == æ˜¯ && (:status food)==false && {bå†°å¿ƒä¸¹}? != null
    use {bå†°å¿ƒä¸¹}?
  [if] (ZCFy) == æ˜¯ && (:status fy)==false
    use (:eq0)
  zc typelv (skill)
  ($prop)=null
  @tip ç›˜è†åä¸‹|å±æ€§ï¼š($gd)<cyn>($prop)<
  [if](prop)!=null
    [if](sum)==1
      ($sum)=2
    ($add)=-1

    [if](ZCProp)!=null&&(ZCProp)!=none
      @js ($num)=[(zcp)].length
      [while] (num)>0
        ($num)=(num)-1
        @js ($op)=[(zcp)][(num)]
        @js ($pe)="(op)".indexOf("%")
        [if] (pe)!=-1
          @js ($op)="(op)".replace("%","")
          @js ($add)="(prop)".search(/(op)ï¼š.*%/)
        [else]
          @js ($add)="(prop)".indexOf("(op)"+"ï¼š")
        [if] (add) !=-1
          [break]
    [if] (add)==-1 && (ZCSpc) !=null
      @js ($add)="(prop)".indexOf("(ZCSpc)")
    [if] (add) !=-1
      zc prop (skill) add
      @tip å¢åŠ å±æ€§|ä¸èƒ½å†æ·»åŠ ($finish)
      @js WG.Send("tm æ·»åŠ [(prop)]")
    [else]
      zc prop (skill) ban
      @js WG.Send("tm æ”¾å¼ƒ[(prop)]")

  [if](sum)==2
    zc typedel (skill)
    @tip æ­¦é“ä¹¦ï¼Œ($qn)æ½œèƒ½ï¼Œ
    tm (ZCSkill)å·²æ¨æ¼”~(qn)æ½œèƒ½
    [if] (qn)>=(max)
      ($finish)=1
    ($sum)=0

  ($num) =1
  [while] (:state)==æ¨æ¼”
    @tip æœ‰äº†æ›´æ·±å…¥çš„ç†è§£|æ½œèƒ½ä¸å¤Ÿ($finish)
    say å·²æ¨æ¼”(num)æ¬¡ (:hour):(:minute):(:second)
    ($num)=(num)+1
    [if] (num) > (ZCNum)||(finish)!=null
      ($num) =0
      [if](sum)==0
        ($sum)=1
      stopstate
      [break]

  [if](finish)!= null
    [break]

[if] (ZCXlu)!=æ— 
  get {r(ZCXlu)}?
xiulian